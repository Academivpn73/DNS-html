<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Academi DNS Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Vazirmatn:wght@300;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --accent1: #00ff88;
      --accent2: #6EE7FF;
      --glass: rgba(8,10,12,0.52);
      --input-bg: #c7d2fe; /* Ø¢Ø¨ÛŒ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø¨Ù†ÙØ´ */
      --input-border: #7c83ff;
    }
    html,body{height:100%}
    body{
      margin:0;padding:20px;
      font-family:"Vazirmatn", system-ui, "Segoe UI", Roboto, Arial;
      background: url('gaming-bg.jpg') center/cover fixed;
      -webkit-font-smoothing:antialiased;
      color:#eafef0;
    }
    .container{max-width:1180px;margin:0 auto}
    .header{ text-align:center; margin-bottom:18px; }
    .brand{
      font-family:'Poppins', system-ui, sans-serif;
      font-weight:800;
      font-size:34px;
      background: linear-gradient(90deg,var(--accent1), #7af6ff);
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      text-shadow:0 6px 30px rgba(0,0,0,0.45);
      display:inline-block;
      padding:6px 12px;
      border-radius:10px;
    }
    .meta{ margin-top:8px; color:#dfffe6; font-size:14px; }
    .meta a{ color:#bafdf0; font-weight:700; text-decoration:none; margin:0 6px; }
    .meta a:hover{ text-decoration:underline; }

    /* Card */
    .card{
      background: linear-gradient(180deg, rgba(6,6,8,0.55), rgba(10,10,12,0.38));
      border:1px solid rgba(124,131,255,0.08);
      backdrop-filter: blur(6px) saturate(120%);
      border-radius:14px;
      padding:14px;
      margin-bottom:16px;
      box-shadow: 0 8px 28px rgba(2,6,10,0.5);
    }
    .card h2{ color: var(--accent1); font-weight:700; margin-bottom:10px; }

    /* Form layout */
    .form-row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom:8px; }
    .form-item{ display:flex; align-items:center; gap:8px; min-width:220px; }
    label{ min-width:120px; color:#dfffe0; font-weight:600; }

    /* Inputs style requested */
    select, input[type="number"], input[type="text"], input[type="search"]{
      background: var(--input-bg);
      color:#000;
      border:1px solid var(--input-border);
      padding:10px 12px;
      border-radius:12px;
      font-weight:600;
      box-shadow: 0 6px 16px rgba(124,131,255,0.07) inset;
      min-width:160px;
    }
    select:focus, input:focus{ outline:none; box-shadow:0 0 0 4px rgba(99,102,241,0.06); }

    /* Buttons */
    .btn{
      background: linear-gradient(90deg, #00ff88, #7af6ff);
      color:#001;
      font-weight:800;
      padding:10px 16px;
      border-radius:12px;
      border:none;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,255,136,0.08);
    }
    .btn:hover{ transform: translateY(-2px); filter:brightness(1.02); }

    /* DNS item */
    .dns-list{ margin-top:12px; display:grid; gap:10px; }
    .dns-item{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px; border-radius:12px;
      background: linear-gradient(180deg, rgba(0,0,0,0.42), rgba(0,0,0,0.25));
      border:1px solid rgba(0,255,136,0.06);
    }
    .dns-left{ max-width:70%; color:#e8fff0; font-weight:600; }
    .dns-meta{ text-align:right; min-width:170px; }

    .stat-ok{ color:#9fffb4; font-weight:800; }
    .stat-mid{ color:#ffd966; font-weight:800; }
    .stat-bad{ color:#ff8b8b; font-weight:800; }

    /* responsive */
    @media (max-width:900px){
      .form-item{ min-width:100%; }
      label{ min-width:90px; }
    }

    /* small helper */
    .muted{ color:#bfffdc; font-size:0.95rem; opacity:0.95; }
    .note{ color:#d6ffe4; font-size:0.92rem; margin-top:8px; }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">ğŸ® Academi DNS Panel</div>
      <div class="meta">
        <a href="https://t.me/Academii73" target="_blank">@Academii73</a>
        <span style="opacity:0.6">|</span>
        <a href="https://t.me/MahdiAGM0" target="_blank">@MahdiAGM0</a>
        <span style="opacity:0.6">|</span>
        <span>Version: 1.0.3</span>
      </div>
    </header>

    <!-- ===== Gaming: Static + Generator ===== -->
    <section class="card" id="gamingCard">
      <h2>âš¡ Generate DNS â€” Gaming</h2>

      <div class="form-row">
        <div class="form-item"><label>Ú©Ø´ÙˆØ±:</label>
          <select id="gCountry">
            <option value="global">ğŸŒ Global</option>
            <option value="ir">ğŸ‡®ğŸ‡· Ø§ÛŒØ±Ø§Ù†</option>
            <option value="us">ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§</option>
            <option value="de">ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†</option>
            <option value="uk">ğŸ‡¬ğŸ‡§ Ø§Ù†Ú¯Ù„ÛŒØ³</option>
            <option value="fr">ğŸ‡«ğŸ‡· ÙØ±Ø§Ù†Ø³Ù‡</option>
            <option value="ca">ğŸ‡¨ğŸ‡¦ Ú©Ø§Ù†Ø§Ø¯Ø§</option>
            <option value="jp">ğŸ‡¯ğŸ‡µ Ú˜Ø§Ù¾Ù†</option>
            <option value="kr">ğŸ‡°ğŸ‡· Ú©Ø±Ù‡â€ŒØ¬Ù†ÙˆØ¨ÛŒ</option>
            <option value="in">ğŸ‡®ğŸ‡³ Ù‡Ù†Ø¯</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ø±ÙˆØ³ÛŒÙ‡</option>
            <option value="tr">ğŸ‡¹ğŸ‡· ØªØ±Ú©ÛŒÙ‡</option>
            <option value="br">ğŸ‡§ğŸ‡· Ø¨Ø±Ø²ÛŒÙ„</option>
          </select>
        </div>

        <div class="form-item"><label>Ù†ÙˆØ¹ IP:</label>
          <select id="gIPver"><option value="ipv4">IPv4</option><option value="ipv6">IPv6</option></select>
        </div>

        <div class="form-item"><label>ØªØ¹Ø¯Ø§Ø¯ (Ø«Ø§Ø¨Øª):</label>
          <input id="gStaticCount" type="number" value="5" min="0">
        </div>

        <div class="form-item"><label>ØªØ¹Ø¯Ø§Ø¯ (Ú˜Ù†Ø±Ø§ØªÙˆØ±):</label>
          <input id="gGenCount" type="number" value="5" min="0">
        </div>
      </div>

      <div class="form-row" style="margin-top:6px">
        <div class="form-item" style="flex:1; min-width:320px;">
          <label>Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒ:</label>
          <select id="gGame" onchange="onGameChange()">
            <option value="other">Other / Ø³Ø§ÛŒØ± (Ø§Ú¯Ø± Ù†Ø¨ÙˆØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯)</option>
            <option>Valorant</option>
            <option>CS:GO</option>
            <option>Fortnite</option>
            <option>PUBG</option>
            <option>Call of Duty</option>
            <option>Apex Legends</option>
            <option>League of Legends</option>
            <option>Dota 2</option>
            <option>Overwatch 2</option>
            <option>FIFA</option>
            <option>GTA Online</option>
            <option>Minecraft</option>
            <option>Roblox</option>
            <option>Battlefield</option>
            <option>Rainbow Six Siege</option>
            <option>World of Warcraft</option>
            <option>Rocket League</option>
            <option>Cyberpunk 2077</option>
            <option>Elden Ring</option>
            <option>Among Us</option>
            <option>Clash of Clans</option>
            <option>Clash Royale</option>
            <option>Brawl Stars</option>
            <option>Mobile Legends</option>
            <option>Free Fire</option>
            <option>PES</option>
            <option>Assassin's Creed</option>
            <option>Far Cry</option>
            <option>Halo</option>
            <option>Diablo IV</option>
            <option>Starfield</option>
            <option>Monster Hunter</option>
            <option>Path of Exile</option>
            <option>Smite</option>
            <option>Warframe</option>
            <option>Destiny 2</option>
            <option>Ark: Survival</option>
            <option>Rust</option>
            <option>Palworld</option>
          </select>
        </div>
        <div class="form-item" id="gameOtherWrap" style="display:none;">
          <label>Ø§Ø³Ù… Ø¨Ø§Ø²ÛŒ:</label>
          <input id="gGameOther" type="text" placeholder="Ø§Ø³Ù… Ø¨Ø§Ø²ÛŒ Ø´Ù…Ø§...">
        </div>
      </div>

      <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap">
        <button class="btn" onclick="onGenerate()">Generate</button>
        <button class="btn" onclick="onGenerate()">Regenerate</button>
        <div class="muted" style="margin-left:8px">ØªÙˆØ¬Ù‡: Ú˜Ù†Ø±Ø§ØªÙˆØ± ÙÙ‚Ø· IPÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù¾Ø§Ø³Ø® HTTPS Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ú©Ø§Ø±Ú©Ø±Ø¯ØŒ Ø§Ø² Ù„ÛŒØ³Øª Ø«Ø§Ø¨Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</div>
      </div>

      <div id="gamingOut" class="dns-list"></div>
    </section>

    <!-- ===== Download DNS ===== -->
    <section class="card" id="downloadCard">
      <h2>ğŸ“¥ DNS Download â€” Unfiltered / Anti-censorship</h2>

      <div class="form-row">
        <div class="form-item"><label>Ø­ÙˆØ²Ù‡/Ú©Ø´ÙˆØ±:</label>
          <select id="dCountry"><option value="ir">ğŸ‡®ğŸ‡· Ø§ÛŒØ±Ø§Ù†</option><option value="global">ğŸŒ Global</option></select>
        </div>
        <div class="form-item"><label>Ù†ÙˆØ¹ IP:</label><select id="dIPver"><option value="ipv4">IPv4</option><option value="ipv6">IPv6</option></select></div>
        <div class="form-item"><label>ØªØ¹Ø¯Ø§Ø¯:</label><input id="dCount" type="number" value="30" min="1"></div>
        <div class="form-item"><button class="btn" onclick="onShowDownload()">Ù†Ù…Ø§ÛŒØ´ DNS Ø¯Ø§Ù†Ù„ÙˆØ¯</button></div>
      </div>

      <div id="downloadOut" class="dns-list"></div>
    </section>

    <!-- ===== All DNS Ping ===== -->
    <section class="card" id="allPingCard">
      <h2>ğŸŒ All DNS Ping â€” Top (DoH-based)</h2>
      <div style="display:flex; gap:10px; align-items:center">
        <button class="btn" onclick="onPingAll()">Ping all</button>
        <div class="muted">ØªØ³Øª Ø¨Ø§ DoH/HTTPS (Ø§Ø² Ø¯ÛŒØ¯ Ø§ØªØµØ§Ù„ Ø´Ù…Ø§). Ù†ØªØ§ÛŒØ¬ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® Ù…Ø±ØªØ¨ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</div>
      </div>
      <div id="allPingOut" class="dns-list" style="margin-top:10px"></div>
    </section>

    <!-- ===== Custom Ping ===== -->
    <section class="card" id="customCard">
      <h2>ğŸ§ª Ping DNS (Custom)</h2>
      <div class="form-row">
        <div class="form-item"><label>Primary:</label><input id="cPrimary" type="text" placeholder="1.1.1.1 ÛŒØ§ dns.google"></div>
        <div class="form-item"><label>Secondary:</label><input id="cSecondary" type="text" placeholder="8.8.8.8"></div>
        <div class="form-item"><button class="btn" onclick="onPingCustom()">Ping</button></div>
      </div>
      <div id="customOut" class="dns-list"></div>
    </section>

    <div style="height:40px"></div>
  </div>

  <script>
  /* --------------------------
     Utilities
     -------------------------- */
  const el = id => document.getElementById(id);
  function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
  function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
  function shuffle(a){const b=[...a]; for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [b[i],b[j]]=[b[j],b[i]];} return b;}

  // download helper
  function downloadFile(name, content, type='text/plain'){
    const blob = new Blob([content], {type});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click();
    setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1500);
  }

  /* --------------------------
     Static DNS lists (expanded)
     Note: I've included many well-known public DNS resolvers + some Iran related (Shecan / common).
     For absolute region-tailored lists you can request additional provider lists and I will add them.
     -------------------------- */
  const STATIC_DNS = {
    // Global public resolvers (many entries)
    global: [
      {name:'Cloudflare', v4:['1.1.1.1','1.0.0.1'], doh:['https://cloudflare-dns.com/dns-query?name=example.com']},
      {name:'Google', v4:['8.8.8.8','8.8.4.4'], doh:['https://dns.google/resolve?name=example.com']},
      {name:'Quad9', v4:['9.9.9.9','149.112.112.112'], doh:['https://dns.quad9.net/dns-query?name=example.com']},
      {name:'OpenDNS', v4:['208.67.222.222','208.67.220.220'], doh:['https://doh.opendns.com/dns-query?name=example.com']},
      {name:'AdGuard', v4:['94.140.14.14','94.140.15.15'], doh:['https://dns.adguard.com/dns-query?name=example.com']},
      {name:'CleanBrowsing', v4:['185.228.168.9','185.228.169.9'], doh:['https://doh.cleanbrowsing.org/doh/security-filter?name=example.com']},
      {name:'Yandex', v4:['77.88.8.8','77.88.8.2'], doh:['https://dns.yandex.net/dns-query?name=example.com']},
      {name:'Verisign', v4:['64.6.64.6','64.6.65.6'], doh:[]},
      {name:'DNS.Watch', v4:['84.200.69.80','84.200.70.40'], doh:[]},
      {name:'SafeDNS', v4:['195.46.39.39','195.46.39.40'], doh:[]},
      {name:'ControlD', v4:['76.76.2.0','76.76.10.0'], doh:[]},
      {name:'AlternateDNS', v4:['76.76.19.19','76.223.122.150'], doh:[]},
      {name:'DNS.SB', v4:['185.222.222.222','45.77.165.194'], doh:[]},
      {name:'OpenNIC', v4:['185.121.177.177','45.32.36.36'], doh:[]},
      {name:'Comodo', v4:['8.26.56.26','8.20.247.20'], doh:[]},
      {name:'UltraDNS (Neustar)', v4:['156.154.70.1','156.154.71.1'], doh:[]},
      {name:'Quad9-secure', v4:['9.9.9.11','149.112.112.11'], doh:['https://dns.quad9.net/dns-query?name=example.com']},
      {name:'Cloudflare-DoH', v4:['1.1.1.1'], doh:['https://cloudflare-dns.com/dns-query?name=example.com']},
      {name:'Google-DoH', v4:['8.8.8.8'], doh:['https://dns.google/resolve?name=example.com']},
      {name:'Cloudflare-IPv6', v6:['2606:4700:4700::1111','2606:4700:4700::1001'], doh:['https://cloudflare-dns.com/dns-query?name=example.com']},
      // add more popular public ones...
    ],
    // Iran-focused (public and known)
    ir: [
      {name:'Shecan', v4:['178.22.122.100','185.51.200.2'], doh:[]},
      {name:'403.online', v4:['185.199.228.100','185.199.228.101'], doh:[]}, // placeholder public style
      // Some common ISP resolvers (not all expose public DoH) â€” these are examples and often internal to ISP networks:
      {name:'MCI (example)', v4:['80.191.64.1','80.191.64.2'], doh:[]},
      {name:'Asiatech (example)', v4:['185.180.48.1','185.180.48.2'], doh:[]},
      {name:'Shatel (example)', v4:['185.107.64.1','185.107.64.2'], doh:[]}
    ],
    // Download oriented pool (large)
    download: []
  };

  // populate download list with many entries (global + repeated variations) to reach ~30
  (function populateDownload(){
    const pool = STATIC_DNS.global.slice();
    // add some duplicates with tags to enlarge list with variety
    const extras = [
      {name:'DNS.Watch', v4:['84.200.69.80','84.200.70.40'], doh:[]},
      {name:'AdGuard (non-filter)', v4:['94.140.14.14','94.140.15.15'], doh:['https://dns.adguard.com/dns-query?name=example.com']},
      {name:'CleanBrowsing Family', v4:['185.228.168.168','185.228.169.168'], doh:['https://doh.cleanbrowsing.org/doh/family-filter?name=example.com']},
      {name:'Yandex', v4:['77.88.8.8','77.88.8.2'], doh:['https://dns.yandex.net/dns-query?name=example.com']},
      {name:'OpenNIC', v4:['185.121.177.177','45.32.36.36'], doh:[]},
    ];
    const arr = pool.concat(extras);
    // ensure ~30 items by duplicating with suffix
    const res = [];
    for(let i=0;i<30;i++){
      const item = arr[i % arr.length];
      res.push(Object.assign({}, item, {name: item.name + (i>0? ' #' + i: '') }));
    }
    STATIC_DNS.download = res;
  })();

  /* --------------------------
     Generator ranges ( realistic patterns )
     -------------------------- */
  const GEN_RANGES = {
    ir: { ipv4:['178.22.*.*','185.51.*.*','5.160.*.*','37.152.*.*'], ipv6:['2a0a::','2a10:50c0::'] },
    global: { ipv4:['1.1.*.*','8.*.*.*','9.*.*.*','94.140.*.*','208.67.*.*'], ipv6:['2606:4700::','2001:4860::','2620:fe::'] }
  };

  function buildIPv4(pat){
    const parts = pat.split('.');
    return parts.map((p, i) => {
      if(p==='*') return (i===3? String(randInt(2,253)) : String(randInt(0,255)));
      return p;
    }).join('.');
  }
  function randHex(len){ let s=''; const h='0123456789abcdef'; for(let i=0;i<len;i++) s+=h[randInt(0,15)]; return s; }
  function buildIPv6(pref){
    if(!pref.includes(':')) pref = '2a00::';
    if(pref.endsWith('::')){
      const base = pref.replace('::','').split(':').filter(Boolean);
      const missing = 8 - base.length;
      const mid = Array.from({length:missing}, ()=>randHex(4));
      return [...base, ...mid].join(':');
    }
    const segs = pref.split(':').filter(Boolean);
    while(segs.length<8) segs.push(randHex(4));
    return segs.join(':');
  }

  /* --------------------------
     Measure / Ping helpers (DoH/HTTPS)
     Strategy:
       - Try doh endpoints first (if given)
       - Fallback: https://<ip>/ (no-cors)
       - Timeout ~ 3800ms
     -------------------------- */
  async function measureEndpoints(endpoints, timeoutMs=3800){
    for(const ep of endpoints){
      try{
        const start = performance.now();
        const controller = new AbortController();
        const id = setTimeout(()=>controller.abort(), timeoutMs);
        try{
          await fetch(ep, {method:'GET', mode:'cors', cache:'no-store', signal:controller.signal});
        }catch(e){
          try{
            await fetch(ep, {method:'GET', mode:'no-cors', cache:'no-store', signal:controller.signal});
          }catch(e2){
            clearTimeout(id); continue;
          }
        } finally { clearTimeout(id); }
        const delta = Math.max(1, Math.round(performance.now() - start));
        return delta;
      }catch(e){
        continue;
      }
    }
    return null;
  }

  function buildTestUrlsFor(entry, ipver='ipv4'){
    const urls = [];
    if(entry.doh && entry.doh.length){
      for(const d of entry.doh){
        if(d.includes('?')) urls.push(d); else urls.push(d + '?name=example.com');
      }
    }
    const ips = (ipver==='ipv6' ? (entry.v6 || []) : (entry.v4 || []));
    for(const ip of ips){
      if(!ip) continue;
      if(ip.includes(':')) urls.push('https://['+ip+']/');
      else urls.push('https://'+ip+'/');
    }
    return urls;
  }

  /* --------------------------
     Render helpers
     -------------------------- */
  function renderDNSList(container, items){
    container.innerHTML = '';
    for(const it of items){
      const div = document.createElement('div'); div.className='dns-item';
      const left = document.createElement('div'); left.className='dns-left'; left.innerHTML = `<div style="font-weight:800">${it.name||'DNS'}</div><div class="muted">${(it.v4? it.v4.join(' | '): (it.v6? it.v6.join(' | '): ''))}</div>`;
      const right = document.createElement('div'); right.className='dns-meta';
      right.innerHTML = `<div class="muted">â€”</div><div style="margin-top:8px"><button class="btn" onclick="copyPair('${(it.v4?it.v4[0]:'')}', '${(it.v4?it.v4[1]:'')}')">Copy</button></div>`;
      div.appendChild(left); div.appendChild(right);
      container.appendChild(div);
    }
  }
  function copyPair(p,s){ const t = [p,s].filter(Boolean).join(', '); navigator.clipboard.writeText(t).then(()=>alert('Ú©Ù¾ÛŒ Ø´Ø¯: '+t)); }

  /* --------------------------
     Generate (Gaming)
     - static: pick from STATIC_DNS.given country/global
     - generated: create candidate IPs from GEN_RANGES and test them (show only those responding)
     -------------------------- */
  async function onGenerate(){
    const out = el('gamingOut'); out.innerHTML = '<div class="muted">Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ùˆ ØªØ³Øª â€” Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...</div>';
    const country = el('gCountry').value || 'global';
    const ipver = el('gIPver').value || 'ipv4';
    const sCount = Math.max(0, parseInt(el('gStaticCount').value||0,10));
    const gCount = Math.max(0, parseInt(el('gGenCount').value||0,10));
    const gameSel = el('gGame').value;
    const gameOther = el('gGameOther').value || null;
    // prepare static pool
    let pool = [];
    if(STATIC_DNS.global) pool = pool.concat(STATIC_DNS.global);
    if(country!=='global' && STATIC_DNS.ir && country==='ir') pool = pool.concat(STATIC_DNS.ir);
    // filter entries with v4/v6 based on ipver
    pool = pool.filter(p=> (ipver==='ipv6'? (p.v6 && p.v6.length) : (p.v4 && p.v4.length)));
    const pickedStatic = shuffle(pool).slice(0, sCount);

    // render static first
    out.innerHTML = '';
    pickedStatic.forEach(it=>{
      const name = it.name + ' (static)';
      const display = { name, v4: it.v4 || [], v6: it.v6 || [] };
      renderDNSList(out, [display]);
    });

    // now generate dynamic ones and test
    if(gCount>0){
      const tested = [];
      const ranges = (GEN_RANGES[country] || GEN_RANGES.global)[ipver];
      if(!ranges || ranges.length===0){
        out.insertAdjacentHTML('beforeend','<div class="muted">Ø±ÙÙ†Ø¬ ØªÙˆÙ„ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø´ÙˆØ± ÛŒØ§ Ù†ÙˆØ¹ IP Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.</div>');
        return;
      }
      let tries=0; const maxTries = Math.max(200, gCount*30);
      while(tested.length < gCount && tries < maxTries){
        tries++;
        const pPat = ranges[randInt(0, ranges.length-1)];
        const sPat = ranges[randInt(0, ranges.length-1)];
        const primary = (ipver==='ipv4')? buildIPv4(pPat) : buildIPv6(pPat);
        const secondary = (ipver==='ipv4')? buildIPv4(sPat) : buildIPv6(sPat);
        // quick duplicate check
        if(tested.some(x=>x[0]===primary && x[1]===secondary)) continue;
        // try to test primary via HTTPS
        const testUrls = [];
        if(primary.includes(':')) testUrls.push('https://['+primary+']/'); else testUrls.push('https://'+primary+'/');
        try{
          const latency = await measureEndpoints(testUrls, 3000).catch(()=>null);
          if(latency != null){
            tested.push([primary, secondary, latency]);
            // render immediately
            const it = { name: 'Generated', v4: (ipver==='ipv4'? [primary, secondary]: []), v6: (ipver==='ipv6'? [primary, secondary]: []) };
            renderDNSList(out, [it]);
          }
        }catch(e){}
      }
      if(tested.length===0){
        out.insertAdjacentHTML('beforeend','<div class="muted">Ù‡ÛŒÚ† Ø¢ÛŒâ€ŒÙ¾ÛŒ ØªÙˆÙ„ÛŒØ¯Ø´Ø¯Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø¨Ø§Ø²Ù‡Ù” Ø²Ù…Ø§Ù†ÛŒ Ù…Ø´Ø®Øµ Ù¾Ø§Ø³Ø® HTTPS Ù†Ø¯Ø§Ø¯. ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª ÛŒØ§ ØªØ¹Ø¯Ø§Ø¯ Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯.</div>');
      }
    }
  }

  /* --------------------------
     Download list (show many)
     -------------------------- */
  function onShowDownload(){
    const out = el('downloadOut'); out.innerHTML = '';
    const country = el('dCountry').value || 'global';
    const ipver = el('dIPver').value || 'ipv4';
    const count = Math.max(1, parseInt(el('dCount').value||30,10));
    let pool = (STATIC_DNS.download || []).slice();
    if(country==='ir') pool = (STATIC_DNS.ir || []).concat(pool);
    const items = pool.slice(0, count);
    renderDNSList(out, items);
  }

  /* --------------------------
     All Ping (DoH-based)
     - uses array allTop list; measures endpoints; sorts by latency and renders
     -------------------------- */
  const allTopList = [
    {name:'Cloudflare', primary:'1.1.1.1', secondary:'1.0.0.1', doh:['https://cloudflare-dns.com/dns-query?name=example.com']},
    {name:'Google', primary:'8.8.8.8', secondary:'8.8.4.4', doh:['https://dns.google/resolve?name=example.com']},
    {name:'Quad9', primary:'9.9.9.9', secondary:'149.112.112.112', doh:['https://dns.quad9.net/dns-query?name=example.com']},
    {name:'OpenDNS', primary:'208.67.222.222', secondary:'208.67.220.220', doh:['https://doh.opendns.com/dns-query?name=example.com']},
    {name:'AdGuard', primary:'94.140.14.14', secondary:'94.140.15.15', doh:['https://dns.adguard.com/dns-query?name=example.com']},
    {name:'CleanBrowsing', primary:'185.228.168.9', secondary:'185.228.169.9', doh:['https://doh.cleanbrowsing.org/doh/security-filter?name=example.com']},
    {name:'Yandex', primary:'77.88.8.8', secondary:'77.88.8.2', doh:['https://dns.yandex.net/dns-query?name=example.com']},
    {name:'Verisign', primary:'64.6.64.6', secondary:'64.6.65.6', doh:[]},
    {name:'DNS.Watch', primary:'84.200.69.80', secondary:'84.200.70.40', doh:[]},
    {name:'SafeDNS', primary:'195.46.39.39', secondary:'195.46.39.40', doh:[]},
    // expand to 30 by duplicating with labels or adding more
  ];

  async function onPingAll(){
    const out = el('allPingOut'); out.innerHTML = '<div class="muted">Ø¯Ø± Ø­Ø§Ù„ Ù¾ÛŒÙ†Ú¯ â€” ØµØ¨ÙˆØ± Ø¨Ø§Ø´ÛŒØ¯...</div>';
    // render placeholders
    out.innerHTML = '';
    allTopList.forEach(it => {
      const node = document.createElement('div'); node.className='dns-item';
      node.innerHTML = `<div class="dns-left"><div style="font-weight:800">${it.name}</div><div class="muted">${it.primary} ${it.secondary? ' | '+it.secondary : ''}</div></div><div class="dns-meta"><div class="muted">â€”</div></div>`;
      out.appendChild(node);
    });
    // concurrency
    const concurrency = 5;
    let idx = 0;
    async function worker(){
      while(true){
        const i = idx++; if(i >= allTopList.length) break;
        const entry = allTopList[i];
        const urls = buildTestUrlsFor({doh: entry.doh || [], v4:[entry.primary, entry.secondary]}, 'ipv4');
        const latency = await measureEndpoints(urls, 3500).catch(()=>null);
        // update dom
        const node = out.children[i];
        if(node){
          const cls = latency==null ? 'stat-bad' : (latency>120? 'stat-bad' : (latency>50? 'stat-mid' : 'stat-ok'));
          node.innerHTML = `<div class="dns-left"><div style="font-weight:800">${entry.name}</div><div class="muted">${entry.primary} ${entry.secondary? ' | '+entry.secondary : ''}</div></div><div class="dns-meta"><div class="${cls}">${latency==null ? 'failed' : latency+' ms'}</div><div style="margin-top:8px"><button class="btn" onclick="copyPair('${entry.primary}','${entry.secondary}')">Copy</button></div></div>`;
        }
      }
    }
    const workers = Array.from({length:concurrency}, ()=>worker());
    await Promise.all(workers);
    // sort by latency (best first)
    try{
      const nodes = Array.from(out.children);
      const arr = nodes.map(n=>{
        const latencyText = n.querySelector('.dns-meta div')?.innerText || 'failed';
        const latency = latencyText==='failed' ? Number.POSITIVE_INFINITY : parseInt(latencyText);
        return {node:n, latency};
      });
      arr.sort((a,b)=>a.latency - b.latency);
      out.innerHTML = ''; arr.forEach(x=> out.appendChild(x.node));
    }catch(e){}
  }

  /* --------------------------
     Custom Ping
     -------------------------- */
  async function onPingCustom(){
    const out = el('customOut'); out.innerHTML = '<div class="muted">Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...</div>';
    out.innerHTML = '';
    const p = el('cPrimary').value.trim();
    const s = el('cSecondary').value.trim();
    async function testAddr(addr){
      if(!addr) return null;
      const attempts = [];
      if(/[a-zA-Z]/.test(addr)){
        if(!addr.startsWith('http')) attempts.push('https://'+addr + (addr.includes('?')? '' : '/dns-query?name=example.com'));
        else attempts.push(addr);
      } else {
        if(addr.includes(':')) attempts.push('https://['+addr+']/'); else attempts.push('https://'+addr+'/');
      }
      const res = await measureEndpoints(attempts, 3500).catch(()=>null);
      return res;
    }
    if(p){
      const lat = await testAddr(p);
      const cls = lat==null ? 'stat-bad' : (lat>120? 'stat-bad' : (lat>50?'stat-mid':'stat-ok'));
      const div = document.createElement('div'); div.className='dns-item';
      div.innerHTML = `<div class="dns-left"><div style="font-weight:800">Primary</div><div class="muted">${p}</div></div><div class="dns-meta"><div class="${cls}">${lat==null? 'failed': lat+' ms'}</div><div style="margin-top:8px"><button class="btn" onclick="copyPair('${p}','')">Copy</button></div></div>`;
      out.appendChild(div);
    }
    if(s){
      const lat2 = await testAddr(s);
      const cls2 = lat2==null ? 'stat-bad' : (lat2>120? 'stat-bad' : (lat2>50?'stat-mid':'stat-ok'));
      const div2 = document.createElement('div'); div2.className='dns-item';
      div2.innerHTML = `<div class="dns-left"><div style="font-weight:800">Secondary</div><div class="muted">${s}</div></div><div class="dns-meta"><div class="${cls2}">${lat2==null? 'failed': lat2+' ms'}</div><div style="margin-top:8px"><button class="btn" onclick="copyPair('${s}','')">Copy</button></div></div>`;
      out.appendChild(div2);
    }
  }

  /* --------------------------
     Game select handler
     -------------------------- */
  function onGameChange(){
    const sel = el('gGame');
    const wrap = el('gameOtherWrap');
    if(sel.value === 'other') wrap.style.display = 'flex'; else wrap.style.display = 'none';
  }

  // init small
  (function init(){
    onGameChange();
  })();

  </script>
</body>
  </html>
