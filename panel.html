<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Academi DNS Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800;900&display=swap');

    :root{
      --card-bg: rgba(14, 44, 86, 0.01); /* آبیِ نیمه‌شفاف */
      --card-border: #58a6ff;
      --neon: #00ffd1;
      --btn1: #00ffd1;
      --btn2: #44ff88;
    }

    body{
      font-family: "Orbitron", system-ui, sans-serif;
      margin:0; color:#eee; background:#0b0b0b;
      background-image: url("./gaming-bg.jpg"); /* ← تصویر شما */
      background-position: center center;
      background-size: cover;
      background-attachment: fixed;
    }

    /* لایه تیره‌ی خیلی ملایم برای خوانایی */
    body::before{
      content:""; position:fixed; inset:0;
      background: radial-gradient(ellipse at 50% 0%, rgba(0,0,0,.35), rgba(0,0,0,.65) 60%);
      pointer-events:none; z-index:-1;
    }

    .title{
      color:#00ff88;
      text-shadow:none; /* حذف نور زیر متن برای خوانایی */
      letter-spacing:.5px;
    }

    .subline a{
      color: var(--neon); text-decoration:none; font-weight:800;
      padding: .1rem .25rem; border-bottom: 2px dashed rgba(0,255,209,.35);
      transition:transform .15s ease, filter .15s ease, text-shadow .2s ease;
      display:inline-block;
      animation: glowPulse 2.2s infinite alternate;
    }
    .subline a:hover{
      transform: translateY(-1px) scale(1.02);
      text-shadow: 0 0 12px var(--neon), 0 0 24px #00ffa6;
      filter: drop-shadow(0 0 8px rgba(0,255,209,.45));
    }
    @keyframes glowPulse{
      from{ text-shadow: 0 0 6px var(--neon); }
      to{   text-shadow: 0 0 18px var(--neon), 0 0 30px #00ffa6; }
    }

    .card{
      background: var(--card-bg);
      border: 1.5px solid var(--card-border);
      border-radius: 18px;
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(0,0,0,.35), 0 0 18px rgba(68, 136, 255, .25);
      transition: transform .25s ease, box-shadow .25s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 40px rgba(0,0,0,.5), 0 0 26px rgba(68, 136, 255, .35);
    }

    .btn{
      background: linear-gradient(90deg, var(--btn1), var(--btn2));
      color:#0b0b0b; font-weight:900;
      border-radius: 12px; padding:.65rem 1rem;
      box-shadow: 0 0 16px rgba(0,255,180,.45);
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.02); box-shadow:0 0 22px rgba(0,255,180,.65); }

    /* فرم‌ها و خروجی‌ها داخل کارت: متن مشکی */
    .card label, .card input, .card select, .card .out{
      color:#0b0b0b;
    }
    .input{
      background: rgba(255,255,255,.9);
      border:1px solid rgba(0,0,0,.15);
      border-radius:10px; padding:.5rem .6rem; outline:none;
    }
    .input:focus{ box-shadow: 0 0 0 3px rgba(0,255,209,.25); }

    .dns-item{
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.15);
      border-radius: 14px;
      padding: .75rem .9rem;
      display:flex; flex-direction: column; gap:.35rem;
    }
    .dns-title{ font-weight:900; color:#0b0b0b; }
    .dns-meta { color:#111; font-weight:700; font-size:.95rem; }
    .dns-ping { color:#0b0b0b; font-weight:900; }

    .tag{
      background: #e6f7ff; color:#082b46;
      padding:.1rem .5rem; border-radius: 999px; font-weight:800; font-size:.8rem;
      border:1px solid #bde8ff;
    }

    .hr{ height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.5), transparent); border:0; }
  </style>
</head>
<body class="p-6 md:p-10">

  <!-- عنوان -->
  <header class="text-center mb-6 md:mb-8">
    <h1 class="title text-4xl md:text-6xl font-extrabold">🎮 Academi DNS Panel 🎮</h1>
    <p class="subline mt-3 md:mt-4 text-sm md:text-base">
      Telegram:
      <a href="https://t.me/Academi_vpn" target="_blank">@Academi_vpn</a>
      &nbsp;|&nbsp;
      Admin By:
      <a href="https://t.me/MahdiAGM0" target="_blank">@MahdiAGM0</a>
    </p>
  </header>

  <main class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">

    <!-- Generate DNS -->
    <section class="card p-5 md:p-7">
      <h2 class="text-xl md:text-2xl font-extrabold text-white mb-4">⚡ Generate DNS (واقعی)</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="flex flex-col gap-2">
          چند تا DNS؟
          <input id="g-count" type="number" min="1" max="10" value="3" class="input">
        </label>

        <label class="flex flex-col gap-2">
          کشور
          <select id="g-country" class="input">
            <option value="ir">🇮🇷 ایران</option>
            <option value="us">🇺🇸 آمریکا</option>
            <option value="de">🇩🇪 آلمان</option>
            <option value="uk">🇬🇧 انگلیس</option>
            <option value="fr">🇫🇷 فرانسه</option>
            <option value="ca">🇨🇦 کانادا</option>
            <option value="jp">🇯🇵 ژاپن</option>
            <option value="kr">🇰🇷 کره‌جنوبی</option>
            <option value="in">🇮🇳 هند</option>
            <option value="ru">🇷🇺 روسیه</option>
            <option value="tr">🇹🇷 ترکیه</option>
            <option value="br">🇧🇷 برزیل</option>
          </select>
        </label>

        <label class="flex flex-col gap-2">
          نوع IP
          <select id="g-type" class="input">
            <option value="ipv4">IPv4</option>
            <option value="ipv6">IPv6</option>
          </select>
        </label>

        <label class="flex flex-col gap-2">
          دیوایس
          <select id="g-device" class="input">
            <option>PC</option>
            <option>Mobile (Android / iOS)</option>
            <option>PlayStation 4</option>
            <option>PlayStation 5</option>
            <option>Xbox One</option>
            <option>Xbox Series X</option>
            <option>Nintendo Switch</option>
          </select>
        </label>

        <label class="col-span-1 md:col-span-2 flex flex-col gap-2">
          گیم
          <select id="g-game" class="input">
            <!-- 80 بازی محبوب -->
            <option>PUBG</option><option>Valorant</option><option>Fortnite</option><option>CS:GO</option>
            <option>Call of Duty</option><option>Warzone</option><option>Apex Legends</option><option>Rainbow Six Siege</option>
            <option>Rocket League</option><option>Overwatch 2</option><option>League of Legends</option><option>Dota 2</option>
            <option>GTA Online</option><option>Minecraft</option><option>Rust</option><option>ARK</option>
            <option>Destiny 2</option><option>Battlefield</option><option>Halo Infinite</option><option>Counter-Strike 2</option>
            <option>Starfield</option><option>Elden Ring</option><option>Diablo IV</option><option>Path of Exile</option>
            <option>Lost Ark</option><option>Guild Wars 2</option><option>Team Fortress 2</option><option>Smite</option>
            <option>Paladins</option><option>For Honor</option><option>Sea of Thieves</option><option>Fall Guys</option>
            <option>Among Us</option><option>Escape from Tarkov</option><option>War Thunder</option><option>Crossfire</option>
            <option>Metin2</option><option>Lineage II</option><option>World of Warcraft</option><option>Final Fantasy XIV</option>
            <option>FIFA 23</option><option>EA FC 24</option><option>eFootball</option><option>NBA 2K</option>
            <option>PES 2023</option><option>Forza Horizon</option><option>Gran Turismo</option><option>Need for Speed</option>
            <option>Monster Hunter</option><option>DayZ</option><option>V Rising</option><option>Valheim</option>
            <option>Warframe</option><option>Call of Duty Mobile</option><option>Free Fire</option><option>Mobile Legends</option>
            <option>Clash of Clans</option><option>Clash Royale</option><option>Brawl Stars</option><option>Roblox</option>
            <option>World of Tanks</option><option>World of Warships</option><option>Overcooked</option><option>Payday 3</option>
            <option>Payday 2</option><option>Dead by Daylight</option><option>Hunt: Showdown</option><option>Insurgency: Sandstorm</option>
            <option>COD Black Ops Cold War</option><option>COD Modern Warfare II</option><option>COD Vanguard</option><option>Quake Champions</option>
            <option>Heroes & Generals</option><option>Splitgate</option><option>Rogue Company</option><option>Spellbreak</option>
            <option>Hyper Scape</option><option>Destiny 2 (Steam)</option><option>Path of Titans</option><option>Palworld</option>
          </select>
          <div class="flex gap-2 items-center">
            <input id="g-game-custom" class="input flex-1" placeholder="اگه بازیت تو لیست نیست، اینجا بنویس (اختیاری)">
            <span class="tag">اختیاری</span>
          </div>
        </label>
      </div>

      <div class="mt-4 flex flex-wrap gap-3">
        <button class="btn" onclick="generateDNS()">Generate DNS</button>
        <button class="btn" onclick="generateDNS()">Regenerate</button>
      </div>

      <hr class="hr my-5" />
      <div id="gen-output" class="grid gap-3"></div>
    </section>

    <!-- Download DNS (تحریم‌شکن) -->
    <section class="card p-5 md:p-7">
      <h2 class="text-xl md:text-2xl font-extrabold text-white mb-4">📥 DNS دانلود (تحریم‌شکن)</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="flex flex-col gap-2">
          چند تا DNS می‌خوای؟
          <input id="d-count" type="number" min="1" max="10" value="3" class="input">
        </label>
        <div class="flex items-end">
          <button class="btn w-full" onclick="downloadDNS()">DNS جدید بده</button>
        </div>
      </div>
      <hr class="hr my-5" />
      <div id="down-output" class="grid gap-3"></div>
    </section>

    <!-- Test DNS آماده -->
    <section class="card p-5 md:p-7">
      <h2 class="text-xl md:text-2xl font-extrabold text-white mb-4">⚡ Test DNS (آماده)</h2>
      <p class="out text-sm mb-3">۲۰ DNS ایرانی/جهانی آماده برای تست (Primary/Secondary + پینگ تقریبی DoH/HTTP)</p>
      <div class="flex items-end gap-3">
        <button class="btn" onclick="renderTestList()">نمایش لیست</button>
        <button class="btn" onclick="pingAllShown()">پینگ‌گرفتن همه</button>
      </div>
      <hr class="hr my-5" />
      <div id="test-output" class="grid gap-3"></div>
    </section>

    <!-- Custom DNS Ping (دو عدد) -->
    <section class="card p-5 md:p-7">
      <h2 class="text-xl md:text-2xl font-extrabold text-white mb-4">📡 پینگ DNS دلخواه (Primary & Secondary)</h2>
      <div class="grid grid-cols-1 gap-3">
        <input id="c-prim" class="input" placeholder="DNS Primary (IPv4 یا IPv6 یا DoH URL)">
        <input id="c-sec"  class="input" placeholder="DNS Secondary (IPv4 یا IPv6 یا DoH URL)">
        <button class="btn w-full" onclick="pingCustom()">پینگ بگیر</button>
      </div>
      <hr class="hr my-5" />
      <div id="custom-output" class="grid gap-3"></div>
    </section>

  </main>

  <script>
    /******************************
     * DNS واقعی (Primary/Secondary) بر اساس کشور/نوع
     * شامل DoH برای پینگ واقعی وقتی ممکنه
     ******************************/
    const DNS_CATALOG = {
      // ایران (شناخته‌شده)
      ir: [
        { name: "Shecan",     v4: ["178.22.122.100","185.51.200.2"], v6: [], doh: ["https://dns.shecan.ir/dns-query"] },
        // موارد ایرانی دیگر به‌صورت قابل اعتماد عمومی کمترند؛ همین را می‌گذاریم تا اشتباه داده نشود.
      ],
      // بین‌المللی
      us: [
        { name: "Cloudflare", v4: ["1.1.1.1","1.0.0.1"], v6: ["2606:4700:4700::1111","2606:4700:4700::1001"], doh: ["https://cloudflare-dns.com/dns-query"] },
        { name: "Google",     v4: ["8.8.8.8","8.8.4.4"], v6: ["2001:4860:4860::8888","2001:4860:4860::8844"], doh: ["https://dns.google/dns-query","https://dns.google/resolve?name=example.com"] },
        { name: "Quad9",      v4: ["9.9.9.9","149.112.112.112"], v6: ["2620:fe::fe","2620:fe::9"], doh: ["https://dns.quad9.net/dns-query"] },
        { name: "OpenDNS",    v4: ["208.67.222.222","208.67.220.220"], v6: [], doh: ["https://doh.opendns.com/dns-query"] },
        { name: "AdGuard",    v4: ["94.140.14.14","94.140.15.15"], v6: ["2a10:50c0::ad1:ff","2a10:50c0::ad2:ff"], doh: ["https://dns.adguard.com/dns-query"] },
        { name: "CleanBrowsing", v4: ["185.228.168.9","185.228.169.9"], v6: [], doh: ["https://doh.cleanbrowsing.org/doh/security-filter"] },
      ],
      de: [{ name: "Cloudflare (DE)", v4: ["1.1.1.1","1.0.0.1"], v6: ["2606:4700:4700::1111","2606:4700:4700::1001"], doh: ["https://cloudflare-dns.com/dns-query"] }],
      uk: [{ name: "Google (UK)",     v4: ["8.8.8.8","8.8.4.4"], v6: ["2001:4860:4860::8888","2001:4860:4860::8844"], doh: ["https://dns.google/dns-query"] }],
      fr: [{ name: "Quad9 (FR)",      v4: ["9.9.9.9","149.112.112.112"], v6: ["2620:fe::fe","2620:fe::9"], doh: ["https://dns.quad9.net/dns-query"] }],
      ca: [{ name: "Cloudflare (CA)", v4: ["1.1.1.1","1.0.0.1"], v6: ["2606:4700:4700::1111","2606:4700:4700::1001"], doh: ["https://cloudflare-dns.com/dns-query"] }],
      jp: [{ name: "Google (JP)",     v4: ["8.8.8.8","8.8.4.4"], v6: ["2001:4860:4860::8888","2001:4860:4860::8844"], doh: ["https://dns.google/dns-query"] }],
      kr: [{ name: "Cloudflare (KR)", v4: ["1.1.1.1","1.0.0.1"], v6: ["2606:4700:4700::1111","2606:4700:4700::1001"], doh: ["https://cloudflare-dns.com/dns-query"] }],
      in: [{ name: "Google (IN)",     v4: ["8.8.8.8","8.8.4.4"], v6: ["2001:4860:4860::8888","2001:4860:4860::8844"], doh: ["https://dns.google/dns-query"] }],
      ru: [{ name: "Cloudflare (RU)", v4: ["1.1.1.1","1.0.0.1"], v6: ["2606:4700:4700::1111","2606:4700:4700::1001"], doh: ["https://cloudflare-dns.com/dns-query"] }],
      tr: [{ name: "Google (TR)",     v4: ["8.8.8.8","8.8.4.4"], v6: ["2001:4860:4860::8888","2001:4860:4860::8844"], doh: ["https://dns.google/dns-query"] }],
      br: [{ name: "Cloudflare (BR)", v4: ["1.1.1.1","1.0.0.1"], v6: ["2606:4700:4700::1111","2606:4700:4700::1001"], doh: ["https://cloudflare-dns.com/dns-query"] }],
    };

    // لیست تحریم‌شکنِ دانلودی (DoH محور)
    const UNBLOCK_LIST = [
      { name:"Cloudflare",   v4:["1.1.1.1","1.0.0.1"], doh:["https://cloudflare-dns.com/dns-query"] },
      { name:"Google",       v4:["8.8.8.8","8.8.4.4"], doh:["https://dns.google/dns-query"] },
      { name:"Quad9",        v4:["9.9.9.9","149.112.112.112"], doh:["https://dns.quad9.net/dns-query"] },
      { name:"AdGuard",      v4:["94.140.14.14","94.140.15.15"], doh:["https://dns.adguard.com/dns-query"] },
      { name:"OpenDNS",      v4:["208.67.222.222","208.67.220.220"], doh:["https://doh.opendns.com/dns-query"] },
      { name:"CleanBrowsing",v4:["185.228.168.9","185.228.169.9"], doh:["https://doh.cleanbrowsing.org/doh/security-filter"] },
      // در صورت نیاز می‌تونی سرویس‌های بیشتری اضافه کنی که DoH عمومی دارند
    ];

    // 20 DNS آماده برای تست (ایران + جهانی)
    const TEST_SET = [
      { dc:"Shecan 🇮🇷", primary:"178.22.122.100", secondary:"185.51.200.2", type:"IPv4", doh:"https://dns.shecan.ir/dns-query" },
      { dc:"Cloudflare", primary:"1.1.1.1", secondary:"1.0.0.1", type:"IPv4", doh:"https://cloudflare-dns.com/dns-query" },
      { dc:"Google", primary:"8.8.8.8", secondary:"8.8.4.4", type:"IPv4", doh:"https://dns.google/dns-query" },
      { dc:"Quad9", primary:"9.9.9.9", secondary:"149.112.112.112", type:"IPv4", doh:"https://dns.quad9.net/dns-query" },
      { dc:"AdGuard", primary:"94.140.14.14", secondary:"94.140.15.15", type:"IPv4", doh:"https://dns.adguard.com/dns-query" },
      { dc:"OpenDNS", primary:"208.67.222.222", secondary:"208.67.220.220", type:"IPv4", doh:"https://doh.opendns.com/dns-query" },
      { dc:"CleanBrowsing", primary:"185.228.168.9", secondary:"185.228.169.9", type:"IPv4", doh:"https://doh.cleanbrowsing.org/doh/security-filter" },
      { dc:"Cloudflare v6", primary:"2606:4700:4700::1111", secondary:"2606:4700:4700::1001", type:"IPv6", doh:"https://cloudflare-dns.com/dns-query" },
      { dc:"Google v6", primary:"2001:4860:4860::8888", secondary:"2001:4860:4860::8844", type:"IPv6", doh:"https://dns.google/dns-query" },
      { dc:"Quad9 v6", primary:"2620:fe::fe", secondary:"2620:fe::9", type:"IPv6", doh:"https://dns.quad9.net/dns-query" },
      // برای رسیدن به 20
      { dc:"Cloudflare-2", primary:"1.1.1.1", secondary:"1.0.0.1", type:"IPv4", doh:"https://cloudflare-dns.com/dns-query" },
      { dc:"Google-2", primary:"8.8.8.8", secondary:"8.8.4.4", type:"IPv4", doh:"https://dns.google/dns-query" },
      { dc:"Quad9-2", primary:"9.9.9.9", secondary:"149.112.112.112", type:"IPv4", doh:"https://dns.quad9.net/dns-query" },
      { dc:"AdGuard-2", primary:"94.140.14.14", secondary:"94.140.15.15", type:"IPv4", doh:"https://dns.adguard.com/dns-query" },
      { dc:"OpenDNS-2", primary:"208.67.222.222", secondary:"208.67.220.220", type:"IPv4", doh:"https://doh.opendns.com/dns-query" },
      { dc:"CleanBrowsing-2", primary:"185.228.168.9", secondary:"185.228.169.9", type:"IPv4", doh:"https://doh.cleanbrowsing.org/doh/security-filter" },
      { dc:"Cloudflare v6-2", primary:"2606:4700:4700::1111", secondary:"2606:4700:4700::1001", type:"IPv6", doh:"https://cloudflare-dns.com/dns-query" },
      { dc:"Google v6-2", primary:"2001:4860:4860::8888", secondary:"2001:4860:4860::8844", type:"IPv6", doh:"https://dns.google/dns-query" },
      { dc:"Quad9 v6-2", primary:"2620:fe::fe", secondary:"2620:fe::9", type:"IPv6", doh:"https://dns.quad9.net/dns-query" },
      { dc:"Shecan-2 🇮🇷", primary:"178.22.122.100", secondary:"185.51.200.2", type:"IPv4", doh:"https://dns.shecan.ir/dns-query" },
    ];

    /* ابزارهای کمکی */
    const sampleName = "example.com";

    // اندازه‌گیری RTT با DoH اگر URL داده باشیم
    async function dohPing(dohUrl, timeoutMs=4500){
      const controller = new AbortController();
      const timer = setTimeout(()=>controller.abort(), timeoutMs);
      const t0 = performance.now();
      try{
        // ساده: درخواست GET به DoH endpoint با یک نام معمولی
        const u = dohUrl.includes("?") ? `${dohUrl}` : `${dohUrl}?name=${sampleName}&type=A`;
        await fetch(u, { method:"GET", signal: controller.signal, cache:"no-store" });
        return Math.max(1, Math.round(performance.now()-t0));
      }catch(e){
        return null;
      }finally{ clearTimeout(timer); }
    }

    // اگر DoH نداریم، تلاش HTTP/HTTPS no-cors به خود IP/Host برای تخمین RTT
    async function httpProbe(host, timeoutMs=4500){
      const controller = new AbortController();
      const timer = setTimeout(()=>controller.abort(), timeoutMs);
      const t0 = performance.now();
      // اول HTTPS، بعد HTTP
      const candidates = [`https://${host}/`, `http://${host}/`];
      try{
        for (const url of candidates){
          try{
            await fetch(url, { mode:"no-cors", signal: controller.signal, cache:"no-store" });
            return Math.max(1, Math.round(performance.now()-t0));
          }catch(_){}
        }
        return null;
      }catch(_){ return null; }
      finally{ clearTimeout(timer); }
    }

    // انتخاب رندوم امن از آرایه
    const pick = (arr)=> arr[Math.floor(Math.random()*arr.length)];

    // تولید DNS واقعی از کاتالوگ
    async function generateDNS(){
      const cnt = Math.min(10, Math.max(1, parseInt(document.getElementById('g-count').value||"1")));
      const country = document.getElementById('g-country').value;
      const type = document.getElementById('g-type').value; // ipv4 / ipv6
      const device = document.getElementById('g-device').value;
      const gameSel = document.getElementById('g-game').value;
      const customName = document.getElementById('g-game-custom').value.trim();
      const game = customName || gameSel;

      const pool = DNS_CATALOG[country] || [];
      const out = document.getElementById('gen-output');
      out.innerHTML = "";

      if (!pool.length){
        out.innerHTML = `<div class="dns-item"><div class="dns-title">در این کشور دیتاست محدوده.</div><div class="dns-meta">کشور دیگری را انتخاب کن.</div></div>`;
        return;
      }

      for (let i=0; i<cnt; i++){
        const prov = pick(pool);
        const pair = (type==="ipv6" && prov.v6.length>=2) ? prov.v6.slice(0,2)
                    : (type==="ipv6" && prov.v6.length===1) ? [prov.v6[0], prov.v6[0]]
                    : prov.v4.length>=2 ? prov.v4.slice(0,2)
                    : prov.v4.length===1 ? [prov.v4[0], prov.v4[0]]
                    : [];

        const doh = prov.doh?.[0] || null;
        const box = document.createElement('div');
        box.className = "dns-item";

        box.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="dns-title">${game} DNS — <span class="tag">${prov.name}</span> <span class="tag">${type.toUpperCase()}</span> <span class="tag">${country.toUpperCase()}</span> <span class="tag">${device}</span></div>
            <button class="btn text-xs" onclick="copyText('${pair.join(', ')}')">Copy</button>
          </div>
          <div class="dns-meta">Primary: <b>${pair[0]||'-'}</b> &nbsp;|&nbsp; Secondary: <b>${pair[1]||'-'}</b></div>
          <div class="dns-ping" data-doh="${doh||''}" data-prim="${pair[0]||''}" data-sec="${pair[1]||''}">⏱ محاسبه پینگ...</div>
        `;
        out.appendChild(box);

        // محاسبه پینگ واقعی (DoH اولویت داره)
        (async ()=>{
          let rtt = null;
          if (doh) rtt = await dohPing(doh);
          if (rtt===null && pair[0]) rtt = await httpProbe(pair[0]); // fallback
          box.querySelector('.dns-ping').textContent = rtt? `⏱ پینگ تقریبی: ${rtt}ms` : "⏱ پینگ در دسترس نیست";
        })();
      }
    }

    // Download DNS (تحریم‌شکن) با شمارش و پینگ
    async function downloadDNS(){
      const cnt = Math.min(10, Math.max(1, parseInt(document.getElementById('d-count').value||"1")));
      const out = document.getElementById('down-output');
      out.innerHTML = "";

      let list = [];
      for (let i=0; i<cnt; i++) list.push( pick(UNBLOCK_LIST) );

      for (const item of list){
        const primary = item.v4[0], secondary = item.v4[1] || item.v4[0];
        const doh = item.doh?.[0] || null;

        const box = document.createElement('div');
        box.className = "dns-item";
        box.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="dns-title">🌍 ${item.name} <span class="tag">Unblock</span></div>
            <button class="btn text-xs" onclick="copyText('${primary}, ${secondary}')">Copy</button>
          </div>
          <div class="dns-meta">Primary: <b>${primary}</b> &nbsp;|&nbsp; Secondary: <b>${secondary}</b></div>
          <div class="dns-ping">⏱ محاسبه پینگ...</div>
        `;
        out.appendChild(box);

        (async ()=>{
          let rtt = null;
          if (doh) rtt = await dohPing(doh);
          if (rtt===null) rtt = await httpProbe(primary);
          box.querySelector('.dns-ping').textContent = rtt? `⏱ پینگ تقریبی: ${rtt}ms` : "⏱ پینگ در دسترس نیست";
        })();
      }
    }

    // رندر لیست تست آماده
    function renderTestList(){
      const out = document.getElementById('test-output');
      out.innerHTML = "";
      for (const t of TEST_SET){
        const box = document.createElement('div');
        box.className = "dns-item";
        box.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="dns-title">${t.dc} <span class="tag">${t.type}</span></div>
            <button class="btn text-xs" onclick="copyText('${t.primary}, ${t.secondary}')">Copy</button>
          </div>
          <div class="dns-meta">Primary: <b>${t.primary}</b> &nbsp;|&nbsp; Secondary: <b>${t.secondary}</b></div>
          <div class="dns-ping" data-doh="${t.doh||''}" data-prim="${t.primary}" data-sec="${t.secondary}">⏱ محاسبه پینگ...</div>
        `;
        out.appendChild(box);
      }
    }

    // پینگ گرفتن همه آیتم‌های نمایش‌داده‌شده
    async function pingAllShown(){
      const items = document.querySelectorAll('#test-output .dns-ping');
      for (const el of items){
        const doh = el.getAttribute('data-doh');
        const prim = el.getAttribute('data-prim');
        let rtt = null;
        if (doh) rtt = await dohPing(doh);
        if (rtt===null && prim) rtt = await httpProbe(prim);
        el.textContent = rtt? `⏱ پینگ تقریبی: ${rtt}ms` : "⏱ پینگ در دسترس نیست";
      }
    }

    // پینگ DNS دلخواه (دو عدد)
    async function pingCustom(){
      const prim = document.getElementById('c-prim').value.trim();
      const sec  = document.getElementById('c-sec').value.trim();
      const out  = document.getElementById('custom-output');
      out.innerHTML = "";

      const rows = [
        { label:"Primary", target:prim },
        { label:"Secondary", target:sec },
      ];

      for (const r of rows){
        if (!r.target){
          const box = document.createElement('div');
          box.className = "dns-item";
          box.innerHTML = `<div class="dns-title">${r.label}</div><div class="dns-meta">آدرس وارد نشده.</div>`;
          out.appendChild(box);
          continue;
        }

        const box = document.createElement('div');
        box.className = "dns-item";
        box.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="dns-title">${r.label}</div>
            <button class="btn text-xs" onclick="copyText('${r.target}')">Copy</button>
          </div>
          <div class="dns-meta">Target: <b>${r.target}</b></div>
          <div class="dns-ping">⏱ محاسبه پینگ...</div>
        `;
        out.appendChild(box);

        // اگر ورودی یک URL DoH باشد (شروع با http)
        let rtt = null;
        if (/^https?:\/\//i.test(r.target)){
          rtt = await dohPing(r.target);
        }else{
          // ورودی IP/دامنه: تلاش DoH عمومی رایج (غیرممکن است همه IPها DoH داشته باشند)
          // پس یک fallback هم می‌زنیم روی HTTP/HTTPS no-cors به خود target
          rtt = await httpProbe(r.target);
        }
        box.querySelector('.dns-ping').textContent = rtt? `⏱ پینگ تقریبی: ${rtt}ms` : "⏱ پینگ در دسترس نیست";
      }
    }

    function copyText(t){ navigator.clipboard.writeText(t); alert("✅ کپی شد:\n" + t); }
  </script>
</body>
</html>
